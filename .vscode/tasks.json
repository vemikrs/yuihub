{
  "version": "2.0.0",
  "tasks": [
    {
        "label": "YuiHub: Reindex (dryRun)",
        "type": "shell",
        "command": "node scripts/chunk_and_lunr.mjs --paths notes --paths docs/logdocs --mode=Shelter --visibility=private,internal --dryRun",
        "problemMatcher": []
        },
        {
        "label": "YuiHub: Reindex",
        "type": "shell",
        "command": "node scripts/chunk_and_lunr.mjs --paths notes --paths docs/logdocs --mode=Shelter --visibility=private,internal",
        "problemMatcher": []
    },
    {
      "label": "YuiHub: Start API Server",
      "type": "shell",
      "command": "npm",
            "args": ["run", "start:api"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "dedicated",
                "showReuseMessage": true,
                "clear": false
            },
            "isBackground": true,
            "options": {
                "env": {
                    "NODE_ENV": "production",
                    "DATA_ROOT": "${workspaceFolder}/yuihub_api/data",
                    "LOCAL_STORAGE_PATH": "${workspaceFolder}/yuihub_api/data/chatlogs",
                    "LUNR_INDEX_PATH": "${workspaceFolder}/yuihub_api/data/index/lunr.idx.json",
                    "TERMS_INDEX_PATH": "${workspaceFolder}/yuihub_api/data/index/terms.json",
                    "STATS_PATH": "${workspaceFolder}/yuihub_api/data/index/stats.json",
                    "PORT": "3000",
                    "HOST": "localhost",
                    "STORAGE_ADAPTER": "local"
                }
            },
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*)$"
                },
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "^.*YuiHub API server listening.*$",
                    "endsPattern": "^.*YuiHub API server listening.*$"
                }
            }
        },
        {
            "label": "YuiHub: Start API Server (Dev)",
            "type": "shell",
            "command": "npm",
            "args": ["run", "dev:api"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "dedicated",
                "showReuseMessage": true,
                "clear": false
            },
            "isBackground": true,
            "options": {
                "env": {
                    "NODE_ENV": "development",
                    "DATA_ROOT": "${workspaceFolder}/yuihub_api/data",
                    "LOCAL_STORAGE_PATH": "${workspaceFolder}/yuihub_api/data/chatlogs",
                    "LUNR_INDEX_PATH": "${workspaceFolder}/yuihub_api/data/index/lunr.idx.json",
                    "TERMS_INDEX_PATH": "${workspaceFolder}/yuihub_api/data/index/terms.json",
                    "STATS_PATH": "${workspaceFolder}/yuihub_api/data/index/stats.json",
                    "PORT": "3000",
                    "HOST": "localhost",
                    "STORAGE_ADAPTER": "local"
                }
            },
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*)$"
                },
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "^.*watching for file changes.*$",
                    "endsPattern": "^.*YuiHub API server listening.*$"
                }
            }
        },
        {
            "label": "YuiHub: Start Dev Server (with Tunnel)",
            "type": "shell",
            "command": "npm",
            "args": ["run", "dev:tunnel"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "dedicated",
                "showReuseMessage": true,
                "clear": false
            },
            "isBackground": true,
            "options": {
                "env": {
                    "NODE_ENV": "development",
                    "DATA_ROOT": "${workspaceFolder}/yuihub_api/data",
                    "LOCAL_STORAGE_PATH": "${workspaceFolder}/yuihub_api/data/chatlogs",
                    "LUNR_INDEX_PATH": "${workspaceFolder}/yuihub_api/data/index/lunr.idx.json",
                    "TERMS_INDEX_PATH": "${workspaceFolder}/yuihub_api/data/index/terms.json",
                    "STATS_PATH": "${workspaceFolder}/yuihub_api/data/index/stats.json",
                    "PORT": "3000",
                    "HOST": "localhost",
                    "STORAGE_ADAPTER": "local",
                    "ENABLE_TUNNEL": "true",
                    "TUNNEL_MODE": "quick"
                }
            },
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*)$"
                },
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "^.*YuiHub API server listening.*$",
                    "endsPattern": "^.*Cloudflare Tunnel: https.*$"
                }
            }
        },
        {
            "label": "YuiHub: Start Prod Server (with Named Tunnel)",
            "type": "shell",
            "command": "bash",
            "args": ["-c", "source yuihub_api/.env && npm run start:prod-tunnel"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "dedicated",
                "showReuseMessage": true,
                "clear": false
            },
            "isBackground": true,
            "options": {
                "env": {
                    "NODE_ENV": "production",
                    "DATA_ROOT": "${workspaceFolder}/yuihub_api/data",
                    "LOCAL_STORAGE_PATH": "${workspaceFolder}/yuihub_api/data/chatlogs",
                    "LUNR_INDEX_PATH": "${workspaceFolder}/yuihub_api/data/index/lunr.idx.json",
                    "TERMS_INDEX_PATH": "${workspaceFolder}/yuihub_api/data/index/terms.json",
                    "STATS_PATH": "${workspaceFolder}/yuihub_api/data/index/stats.json",
                    "PORT": "3000",
                    "HOST": "localhost",
                    "STORAGE_ADAPTER": "local",
                    "ENABLE_TUNNEL": "true",
                    "TUNNEL_MODE": "named"
                }
            },
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*)$"
                },
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "^.*YuiHub API server listening.*$",
                    "endsPattern": "^.*Cloudflare Tunnel: https://poc-yuihub.vemi.jp.*$"
                }
            }
        },
        {
            "label": "YuiHub: Start MCP Server", 
            "type": "shell",
            "command": "npm",
            "args": ["run", "start:mcp"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "dedicated",
                "showReuseMessage": true,
                "clear": false
            },
            "isBackground": true,
            "options": {
                "env": {
                    "YUIHUB_API": "http://localhost:3000"
                }
            },
            "problemMatcher": {
                "pattern": {
                    "regexp": "^(.*)$"
                },
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "^.*Starting yuihub-mcp.*$",
                    "endsPattern": "^.*MCP Server ready.*$"
                }
            }
        },
        {
            "label": "YuiHub: Build Search Index",
            "type": "shell",
            "command": "npm",
            "args": ["run", "build-all"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": true,
                "clear": false
            },
            "options": {
                "env": {
                    "DATA_ROOT": "${workspaceFolder}/yuihub_api/data",
                    "LOCAL_STORAGE_PATH": "${workspaceFolder}/yuihub_api/data/chatlogs"
                }
            },
            "problemMatcher": []
        },
        {
            "label": "YuiHub: Health Check",
            "type": "shell",
            "command": "curl",
            "args": ["-s", "-f", "http://localhost:3000/health"],
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": []
        },
        {
            "label": "YuiHub: API Quick Test",
            "type": "shell", 
            "command": "bash",
            "args": ["-c", "curl -s http://localhost:3000/health && echo '\n✓ Health OK' && curl -s 'http://localhost:3000/recent?n=3' | head -20 && echo '\n✓ Recent API OK'"],
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": []
        },
        {
            "label": "YuiHub: Safe Stop Server",
            "type": "shell",
            "command": "bash", 
            "args": ["-c", "pkill -f 'node.*yuihub_api/src/server.js' && echo '✓ Server stopped safely' || echo 'ℹ No server process found'"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": []
        },
        {
            "label": "YuiHub: Run YuiFlow Tests",
            "type": "shell",
            "command": "npm",
            "args": ["run", "test:yuiflow"],
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": []
        },
        {
            "label": "YuiHub: E2E Workflow Test", 
            "type": "shell",
            "command": "./run-tests.sh",
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": []
        },
        {
            "label": "YuiHub: Full Development Stack",
            "type": "shell",
            "command": "npm",
            "args": ["run", "dev:full"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "dedicated",
                "showReuseMessage": true,
                "clear": false
            },
            "isBackground": true,
            "options": {
                "env": {
                    "NODE_ENV": "development",
                    "DATA_ROOT": "${workspaceFolder}/data",
                    "YUIHUB_API": "http://localhost:3000"
                }
            },
            "problemMatcher": []
        },
        {
            "label": "YuiHub: Validate YuiFlow Compliance",
            "type": "shell",
            "command": "npm", 
            "args": ["run", "validate:yuiflow"],
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": []
        }
    ]
}